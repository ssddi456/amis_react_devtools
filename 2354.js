"use strict";(self.webpackChunk_amis_devtools_demo_app=self.webpackChunk_amis_devtools_demo_app||[]).push([["2354"],{56105:function(e,t,n){n.r(t),n.d(t,{setupLanguageMode:()=>a});var i=n(70625),s=n(63644);class l{constructor(e,t,n){this._languageId=e,this._worker=t,this._defaults=n,this._disposables=[],this._listener=Object.create(null);const s=e=>{let t=e.getLanguageId();if(t===this._languageId){var n;let i;this._listener[e.uri.toString()]=e.onDidChangeContent((n=()=>{this._doValidate(e.uri,t)},i=null,(...e)=>{i&&clearTimeout(i),i=setTimeout(()=>{i&&clearTimeout(i),i=null,null==n||n(...e)},500)})),this._doValidate(e.uri,t)}},l=e=>{i.EN.setModelMarkers(e,this._languageId,[]);let t=e.uri.toString(),n=this._listener[t];n&&(n.dispose(),delete this._listener[t])};this._disposables.push(i.EN.onDidCreateModel(s)),this._disposables.push(i.EN.onWillDisposeModel(l)),this._disposables.push(i.EN.onDidChangeModelLanguage(e=>{l(e.model),s(e.model)})),this._disposables.push(this._defaults.onDidChange(e=>{i.EN.getModels().forEach(e=>{e.getLanguageId()===this._languageId&&(l(e),s(e))})})),this._disposables.push({dispose:()=>{for(let e in this._listener)this._listener[e].dispose()}}),i.EN.getModels().forEach(s)}dispose(){this._disposables.forEach(e=>e&&e.dispose()),this._disposables=[]}_doValidate(e,t){this._worker(e).then(t=>{var n;let s=(null==(n=i.EN.getModel(e))?void 0:n.getValue())||"";return"function"==typeof this._defaults.preprocessCode&&(s=this._defaults.preprocessCode(s)),t.doValidation(s)}).then(n=>{let s=n.map(e=>{var t;return t=e,{severity:i.cj.Error,startLineNumber:t.startLine,startColumn:t.startColumn,endLineNumber:t.endLine,endColumn:t.endColumn,message:t.message,code:void 0,source:"dt-sql-parser"}}),l=i.EN.getModel(e);l&&l.getLanguageId()===t&&i.EN.setModelMarkers(l,t,s)}).then(void 0,e=>{console.error(e)})}}class o{constructor(e,t){this._worker=e,this._defaults=t}get triggerCharacters(){return Array.isArray(this._defaults.triggerCharacters)?this._defaults.triggerCharacters:["."," "]}provideCompletionItems(e,t,n,s){let l=e.uri;return this._worker(l).then(e=>{var n;let s=(null==(n=i.EN.getModel(l))?void 0:n.getValue())||"";return"function"==typeof this._defaults.preprocessCode&&(s=this._defaults.preprocessCode(s)),e.doCompletionWithEntities(s,t)}).then(({suggestions:i,allEntities:s,context:l})=>{let o=[];return(null==l?void 0:l.isStatementBeginning)&&(o=this._defaults.completionSnippets.map(e=>Object.assign(Object.assign({},e),{insertText:"string"==typeof e.body?e.body:e.body.join("\n")}))),this._defaults.completionService(e,t,n,i,s,o)}).then(n=>{let s=e.getWordUntilPosition(t),l=new i.Q6(t.lineNumber,s.startColumn,t.lineNumber,s.endColumn);return{suggestions:(Array.isArray(n)?n:n.suggestions).map(e=>{var t,n;return Object.assign(Object.assign({},e),{insertText:null!=(t=e.insertText)?t:"string"==typeof e.label?e.label:e.label.label,range:null!=(n=e.range)?n:l})}),dispose:Array.isArray(n)?void 0:n.dispose,incomplete:Array.isArray(n)?void 0:n.incomplete}})}}class r{constructor(e,t){this._worker=e,this._defaults=t}provideDefinition(e,t,n){let i=e.uri;return e.getLineContent(t.lineNumber).startsWith("--")?null:this._worker(i).then(t=>{let n=(null==e?void 0:e.getValue())||"";return"function"==typeof this._defaults.preprocessCode&&(n=this._defaults.preprocessCode(n)),t.getAllEntities(n)}).then(n=>{let i=e.getWordAtPosition(t),l={line:-1,startIndex:-1,endIndex:-1,startColumn:-1,endColumn:-1},o=null==n?void 0:n.find(e=>{let n=e.position;return n.startColumn===(null==i?void 0:i.startColumn)&&n.endColumn===(null==i?void 0:i.endColumn)&&n.line===t.lineNumber?e:null});if(o)for(let e in n){let t=n[Number(e)];if(t.entityContextType.includes("Create")&&(null==i?void 0:i.word)&&t.text===(null==i?void 0:i.word)&&t.entityContextType.includes(o.entityContextType)){l=t.position;break}}if(l&&-1!==l.line)return{uri:e.uri,range:new s.Range(null==l?void 0:l.line,null==l?void 0:l.startColumn,null==l?void 0:l.line,null==l?void 0:l.endColumn)}})}}class u{constructor(e,t){this._worker=e,this._defaults=t}provideReferences(e,t,n,i){let l=e.uri;if(e.getLineContent(t.lineNumber).startsWith("CREATE"))return this._worker(l).then(t=>{let n=(null==e?void 0:e.getValue())||"";return"function"==typeof this._defaults.preprocessCode&&(n=this._defaults.preprocessCode(n)),t.getAllEntities(null==e?void 0:e.getValue())}).then(n=>{let i=e.getWordAtPosition(t),l=[],o=null==n?void 0:n.find(e=>{let n=e.position;return n.startColumn===(null==i?void 0:i.startColumn)&&n.endColumn===(null==i?void 0:i.endColumn)&&n.line===t.lineNumber?e:null});return o&&(null==n||n.forEach(t=>{if((null==i?void 0:i.word)&&t.text===(null==i?void 0:i.word)&&o.entityContextType.includes(t.entityContextType)){let n=null;n=t.position,l.push({uri:e.uri,range:new s.Range(null==n?void 0:n.line,null==n?void 0:n.startColumn,null==n?void 0:n.line,null==n?void 0:n.endColumn)})}})),l})}}var d=n(51315);function a(e){let t=[],n=[],s=new d.O(e);t.push(s);let a=(...e)=>s.getLanguageServiceWorker(...e);return!function(){let{languageId:t,modeConfiguration:s}=e;h(n),s.diagnostics&&n.push(new l(t,a,e)),s.completionItems.enable&&n.push(i.eo.registerCompletionItemProvider(t,new o(a,e))),s.references&&n.push(i.eo.registerReferenceProvider(t,new u(a,e))),s.definitions&&n.push(i.eo.registerDefinitionProvider(t,new r(a,e)))}(),t.push(p(n)),p(t)}function p(e){return{dispose:()=>h(e)}}function h(e){for(var t;e.length;)null==(t=e.pop())||t.dispose()}}}]);
//# sourceMappingURL=2354.js.map